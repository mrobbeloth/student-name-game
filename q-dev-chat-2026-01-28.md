<div style="display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; padding: 200px 0 20px 0;">

<div style="font-size: 24px; margin-bottom: 12px;"><strong>Amazon Q</strong></div>
<div style="background: rgba(128, 128, 128, 0.15); border: 1px solid rgba(128, 128, 128, 0.25); border-radius: 8px; padding: 8px; margin: 4px 0; text-align: center;">
<div style="font-size: 14px; margin-bottom: 4px;"><strong>Did you know?</strong></div>
<div>Ask Q to review your code and see results in the code issues panel!</div>
</div>

Select code & ask me to explain, debug or optimize it, or type `/` for quick actions

</div>

---

Tell me about the architecture of this codebase

---

I'll explore the codebase structure to give you a comprehensive overview of the architecture.

---


Based on my exploration of the codebase, here's a comprehensive overview of the Student Name Game architecture:

## Architecture Overview

This is a **JavaFX 21 desktop application** following a **layered MVC architecture** with modern Java 21 features.

### Core Architectural Layers

**1. Model Layer** (`model/`)
- Uses **Java 21 records** for immutable data structures
- `Student` - Represents a student with name and photo path
- `GameSession` - Manages active game state, scoring, and streaks
- `GameStatistics` - Tracks lifetime performance metrics
- `GameMode` - Enum for game types (Matching, Multiple Choice, Fill-in-Blank)
- `UnmatchedImage` - Represents photos that couldn't auto-match to roster

**2. Service Layer** (`service/`)
Business logic and data management:
- `ConfigService` - Singleton managing app configuration (portable vs installed mode)
- `ImageService` - Loads/matches photos to roster, file watching with virtual threads
- `RosterService` - Parses Excel rosters using Apache POI
- `FuzzyMatcher` - Levenshtein distance matching for photo-to-name matching
- `MappingService` - Persists manual photo-to-name mappings (JSON)
- `StatisticsService` - Tracks game performance, persists to JSON
- `SoundService` - Audio feedback using JavaFX Media
- `KeyboardShortcutService` - Global keyboard shortcuts
- `ExportService` - Import/export data as ZIP archives

**3. Controller Layer** (`controller/`)
JavaFX FXML controllers:
- `MainDashboardController` - Main menu, statistics display, navigation
- `GameControllerBase` - Abstract base for game controllers with shared logic
- `MatchingGameController` - Drag-and-drop photo matching
- `MultipleChoiceController` - Multiple choice quiz
- `FillInBlankController` - Text input game
- `SettingsDialogController` - Configuration dialog
- `UnmatchedDialogController` - Manual photo assignment
- `WelcomeDialogController` - First-run setup

**4. View Layer** (`resources/views/`)
- FXML files defining UI layouts
- Separated from controllers for clean MVC
- Styled with CSS (`css/style.css`)

**5. Utility Layer** (`util/`)
- `AnimationFactory` - Reusable JavaFX animations
- Helper functions and shared utilities

### Key Architectural Patterns

**Singleton Pattern**
All services use singleton pattern for global state management:
```java
ConfigService.getInstance()
ImageService.getInstance()
StatisticsService.getInstance()
```

**Template Method Pattern**
`GameControllerBase` defines game flow template, subclasses implement specifics:
- `loadQuestion()` - Load next question
- `playCorrectAnimation()` - Visual feedback
- `showResults()` - End game display

**Observer Pattern**
- File watching with `WatchService` for directory changes
- Callbacks for reload notifications
- JavaFX properties and bindings for UI updates

**Strategy Pattern**
Different game modes implement different question strategies while sharing core session logic.

### Modern Java 21 Features

- **Records** - Immutable data models (Student, GameSession)
- **Pattern Matching** - Switch expressions with pattern matching
- **Virtual Threads** - File watching uses `Thread.startVirtualThread()`
- **Preview Features** - Enabled with `--enable-preview` flag

### Data Flow

1. **Startup**: `Launcher` → `NameGameApplication` → Load config
2. **First Launch**: Show welcome dialog → Configure photo directory
3. **Image Loading**: 
   - `RosterService` parses Excel roster
   - `ImageService` scans photo directory
   - `FuzzyMatcher` auto-matches photos to names
   - Manual mapping for unmatched photos
4. **Game Flow**:
   - Dashboard → Select game mode
   - `GameSession` manages state
   - Controllers handle UI/input
   - `StatisticsService` records results
   - Return to dashboard

### Data Persistence

**Two Modes**:
- **Installed**: `~/.namegame/` (user home)
- **Portable**: `./data/` (relative to JAR)

**Files**:
- `config.properties` - App settings
- `mappings.json` - Manual photo mappings (Gson)
- `statistics.json` - Game statistics (Gson)
- `exports/` - Backup archives

### Technology Stack

- **Java 21 LTS** - Language runtime
- **JavaFX 21** - UI framework (controls, FXML, media)
- **Apache POI 5.5.1** - Excel file parsing
- **Apache Commons Text 1.15.0** - Levenshtein distance
- **Gson 2.13.2** - JSON serialization
- **Maven** - Build system with Shade plugin for fat JARs

### Build System

Maven with multiple plugins:
- `maven-compiler-plugin` - Java 21 compilation
- `javafx-maven-plugin` - Development execution
- `maven-shade-plugin` - Fat JAR with dependencies
- `maven-assembly-plugin` - Portable ZIP distributions

### Thread Safety

- Services use singleton pattern with lazy initialization
- File watching runs on virtual threads
- UI updates use `Platform.runLater()` for JavaFX thread safety
- Atomic operations for watch service state

This architecture provides clean separation of concerns, testability, and maintainability while leveraging modern Java features for performance and developer experience.